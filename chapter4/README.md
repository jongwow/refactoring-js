# 4 테스트 구축하기

리팩터링을 제대로 하려면 견고한 테스트 스위트(test suite)가 뒷받침돼야 한다.

## 4.1 자기 테스트 코드의 가치

프로그래머들이 실제로 코드를 작성하는 시간의 비중은 그리 크지 않다. 대부분의 시간을 디버깅에 쓴다. 진짜 끔찍한 건 버그를 찾는 여정이다. 테스트가 성공했는지 확인하는 작업을 내가 하는 것이 아니라 컴퓨터가
알려준다면? 자가 테스트 소프트웨어가 그렇게 탄생했다.

**모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자**

컴파일할 때마다 테스트도 함께 하기 때문에 디버깅 시간이 크게 줄어들고 생산성이 급상승했다.

**테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다.**

테스트부터 작성하는 습관을 바탕으로 켄트백의 TDD가 등장했다.

## 4.3 첫 번째 테스트

**실패해야 할 상황에서는 반드시 실패하게 만들자**

**자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자**

## 4.4 테스트 추가하기

- 클래스가 하는 일을 모두 살펴보고 각각의 기능에 오류가 생길 수 있는 조건을 하나씩 테스트하는 식으로 진행
- 테스트는 위험 요인을 중심으로 작성하기! 현재, 향후 발생할 버그를 찾는것이 목적

**완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다.**

```javascript
  const asia = new Province(sampleProvinceData());
it('shortfall', function () {
  expect(asia.shortfall).equal(5);
})
it('profit', function () {
  expect(asia.profit).equal(230);
})
```

위와 같이 작성하면 안됨. **테스트끼리 상호작용하게 하는 공유 픽스처**를 생성함. 한 테스트에서 province를 수정하면 다른 값이 오염되어 다른 테스트가 실패할 수 있음.

차라리 아래와 같이 하는 것이 낫다.

```javascript
let asia;
beforeEach(function () {
  asia = new Province(sampleProvinceData());
})
it('shortfall', function () {
  expect(asia.shortfall).equal(5);
})
it('profit', function () {
  expect(asia.profit).equal(230);
})
```

## 4.5 픽스처 수정하기

- beforeEach에서 '설정'한 표준 픽스처를 취해, 테스트를 '수행' 후 잘 처리했는지 검증'
    - 설정-실행-검증(setup-exercise-verify)
    - 조건-발생-결과(given-when-then)
    - 준비-수행-단언(arrange-act-assert)
- 해체(teardown)혹은 청소(cleanup)이라는 단계(픽스처를 제거해 테스트간 영향도 제거)도 있지만 명시적 언급 잘 안함. 왜냐면 beforeEach에서 자동으로 재설정되기 때문. 
  물론 필요한 경우(픽스처 생성이 무거운 연산일 경우)도 있긴 함.

## 4.6 경계 조건 검사하기
- 지금까진 순조롭고 의도대로인 꽃길**happy path** 상황. 그것을 벗어난 경우엔?

**문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 조건을 집중적으로 테스트하자**

- 에러와 실패
  - 실패(failure): 검증 단계에서 실제 값이 예상 범위를 벗어났다는 뜻.
  - 에러(error): 검증보다 앞선 과정에서 발생한 예외 상황. 코드 작성자가 미처 예상하지 못한 상황
- 에러는 어떻게 Handle? 에러 상황을 잘 처리하도록 코드 추가

**어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 있는 기회를 날리는 셈이다.**

## 4.7 끝나지 않은 여정
- 테스트는 리팩터링에 반드시 필요한 토대일 뿐만 아니라 프로그래밍에 중요한 역할
  ** 버그리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자**
